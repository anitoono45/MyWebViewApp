name: Build with Global Gradle

on:
  push:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # 1. Download the ZIP from your repo
    - uses: actions/checkout@v3

    # 2. Set up Java 17 (Required for Android)
    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'

    # 3. Unzip the file
    - name: Unzip Project
      run: |
        unzip -q *.zip
        
        # If the zip created a subfolder, move files up to the main folder
        # This finds where 'build.gradle' is and moves everything there to the root
        ROOT_DIR=$(find . -name build.gradle | head -n 1 | xargs dirname)
        if [ "$ROOT_DIR" != "." ]; then
          cp -r $ROOT_DIR/* .
          cp -r $ROOT_DIR/.* . 2>/dev/null || true
        fi
        
        echo "Project extracted. Ready to build."

    # 4. BUILD COMMAND (Modified)
    # We use 'gradle' (Global) instead of './gradlew' (Local/Missing)
    - name: Build APK
      run: gradle assembleDebug --no-daemon --stacktrace

    # 5. Upload the APK
    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: my-app-apk
        path: app/build/outputs/apk/debug/app-debug.apk
